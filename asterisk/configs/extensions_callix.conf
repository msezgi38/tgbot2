;=============================================================================
; Dialplan Configuration for Press-1 IVR Bot 5 (VoipZone)
;=============================================================================
; âš ï¸ APPEND this to your existing /etc/asterisk/extensions.conf
;=============================================================================

[press-one-ivr-5]
exten => _X.,1,NoOp(=== Press-1 IVR Call Started [BOT5-VOIPZONE] ===)
 same => n,NoOp(CallID: ${CHANNEL(uniqueid)})
 same => n,NoOp(Destination: ${EXTEN})
 same => n,NoOp(CallerID: ${CALLERID(num)})
 same => n,Answer()
 same => n,Wait(0.5)
 same => n,Set(CALL_ID=${CALL_ID})
 same => n,Set(DESTINATION=${EXTEN})
 same => n,Set(DTMF_PRESSED=0)
 same => n,Set(CALL_START=${EPOCH})
 same => n,NoOp(Playing IVR audio: ${VOICE_FILE})
 same => n,GotoIf($["${VOICE_FILE}" != ""]?play_voice:play_default)
 same => n(play_voice),Playback(${VOICE_FILE})
 same => n,Goto(wait_dtmf)
 same => n(play_default),Playback(custom/press_one_ivr)
 same => n(wait_dtmf),NoOp(Voice file playback complete)
 same => n,NoOp(Waiting for DTMF input - 10 second timeout)
 same => n,Read(DTMF_INPUT,beep,1,,,10)
 same => n,GotoIf($["${DTMF_INPUT}" = "1"]?pressed_one:no_response)
 same => n(pressed_one),NoOp(User pressed 1 - SUCCESS!)
 same => n,Set(DTMF_PRESSED=1)
 same => n,GotoIf($["${OUTRO_FILE}" != ""]?play_outro:play_thankyou)
 same => n(play_outro),Playback(${OUTRO_FILE})
 same => n,Goto(send_webhook)
 same => n(play_thankyou),Playback(thank-you)
 same => n,Goto(send_webhook)
 same => n(no_response),NoOp(No valid response received: ${DTMF_INPUT})
 same => n,Set(DTMF_PRESSED=0)
 same => n,Goto(send_webhook)
 same => n(send_webhook),Set(CALL_DURATION=$[${EPOCH} - ${CALL_START}])
 same => n,NoOp(Sending DTMF webhook: digit=${DTMF_INPUT} duration=${CALL_DURATION} campaign=${CAMPAIGN_ID})
 same => n,Set(CURL_RESULT=${CURL(http://localhost:8004/webhook/dtmf,call_id=${CALL_ID}&digit=${DTMF_INPUT}&duration=${CALL_DURATION}&campaign_id=${CAMPAIGN_ID}&campaign_data_id=${CAMPAIGN_DATA_ID})})
 same => n,NoOp(Webhook response: ${CURL_RESULT})
 same => n,NoOp(Call completed - Hanging up)
 same => n,Hangup()
 same => n(call_failed),NoOp(Call failed or hungup early)
 same => n,Hangup()

[from-voipzone]
exten => _X.,1,NoOp(Incoming call from VoipZone: ${CALLERID(all)})
 same => n,NoOp(This trunk is outbound-only - rejecting)
 same => n,Busy()
 same => n,Hangup()
